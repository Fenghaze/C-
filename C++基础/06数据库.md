# MySQL

## 使用Connector C++

### VS2019 配置

- 0、【项目】-【属性】-【平台：x64】

- 1、【项目】-【属性】-【C/C++】-【常规】-【附加包含目录】-添加`C:\Program Files\MySQL\Connector C++ 8.0\include`
- 2、【链接器】-【常规】-【附加库目录】-添加`C:\Program Files\MySQL\Connector C++ 8.0\lib64\vs14`
- 3、【链接器】-【输入】-【附加依赖项】-添加`mysqlcppconn.lib`
- 4、将mysqlcppconn-7-vs14.dll拷贝至程序根目录下，还需要将libeay32.dll和ssleay32.dll也拷贝至程序根目录下
- 5、下载boost库；【C/C++】-【常规】-【附加包含目录】-添加`D:\boost_1_66_0`
- 6、程序引入头文件：

```c++
#include "jdbc/mysql_connection.h"
#include "jdbc/mysql_driver.h"
#include "jdbc/cppconn/statement.h"
#include "jdbc/cppconn/prepared_statement.h"
```

### 连接数据库

```c++
//初始化驱动
sql::mysql::MySQL_Driver* driver = NULL;
sql::Connection* con = NULL;
driver = sql::mysql::get_mysql_driver_instance();
if (driver == NULL)
{
    cout << "driver is null" << endl;
}
//连接数据库服务器，test为数据库，root为用户名，12345为密码
con = driver->connect("tcp://localhost:3306/test", "root", "12345");
if (con == NULL)
{
    cout << "conn is null" << endl;
}
cout << "connect suceess" << endl;
```

### Statement查询

```c++
//获取执行 sql 语句对象 stmt
sql::Statement* stmt = con->createStatement();
//查询结果对象
sql::ResultSet* res;
CString str;
//执行查询语句
res = stmt->executeQuery("SELECT * FROM student");
while (res->next())
{
    name = res->getString("name").c_str();
    age = res->getInt("age");
    UpdateData(FALSE);
}
```

### PreparedStatement 增删改查

```c++
sql::PreparedStatement* prep_stmt;	//得到执行sql的PreparedStatement对象
sql::ResultSet* res;	//结果集对象
//查询
prep_stmt = con->prepareStatement("select * from admin where username=?");
prep_stmt->setString(1, user.c_str());	//设置？对应的值
res = prep_stmt->executeQuery();	//执行语句，结果存放在结果集
while(res->next())
{
    res->getInt(1);//获取第一列数据
    res->getString("col_name").c_str();//获取列名，数据类型为char
    res->getInt("col_name")//获取列名，数据类型为int
}

//插入
prep_stmt = con->prepareStatement("insert into student(name, age) VALUES (?,?)");
prep_stmt->setString(1, "Gwrew");
prep_stmt->setString(2, "15");
bool updatecount = prep_stmt->executeUpdate();	//执行插入语句

//删除
prep_stmt = con->prepareStatement("delete from student where id=3");
updatecount = prep_stmt->executeUpdate();	//执行删除语句

//修改
prep_stmt = con->prepareStatement("update student set age=19 where id=4");
updatecount = prep_stmt->executeUpdate();	//执行修改语句
```


